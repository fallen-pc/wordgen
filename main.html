<!DOCTYPE html>                                                                                                                                                                              ```````````````````````                                                                                                                                                                                                                                                                                                                                                          <!DOCTYPE html>

<html lang="en">

<head>

<meta charset="utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Business/Personal Transfer Word Generators</title>

<meta name="theme-color" content="#66e4f0" />

<style>

  /* CRT-green theme to match the provided logo */

  :root{

    --bg:#050c08;

    --card:#0a1410;

    --muted:#7aa690;

    --border:#133326;

    --fg:#d2ffe7;

    --accent:#66e4f0;

    --accent-2:#34c7e3;

    --biz:#0d1f24;

    --biz-br:#66e4f0;

    --biz-text:#b9f8db;

    --per:#291a30;

    --per-br:#b67ad6;

    --button-bg:#0e1d17;

    --input-bg:#07140f;

    --pill-bg:#0c1d17;

    --tag-bg:#08130f;

    --tag-text:#9beec9;

    --hint:#9bd4bd;

    --placeholder-border:#503050;

    --uc-bg:#3a1d3a;

    --uc-border:#805080;

    --primary-on-accent:#062f1f;

    --ok:#8be28b;

    --fail:#ff8686;

    --scanline:rgba(102,228,240,0.05);

    --shadow:rgba(0,0,0,.45);

    --halo-soft:rgba(16,229,128,.05);

    --halo-mid:rgba(16,229,128,.1);

    --halo-strong:rgba(16,229,128,.35);

    --halo-glow:rgba(16,229,128,.4);

    --halo-spot:rgba(16,229,128,.08);

    --business-btn-bg:rgba(16,229,128,.12);

    --business-btn-hover:rgba(16,229,128,.18);

    --personal-btn-bg:rgba(181,83,208,.12);

    --logo-band:rgba(16,229,128,.25);

    --logo-band-soft:rgba(16,229,128,.05);

  }

  *{box-sizing:border-box}

  body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Roboto,Arial,sans-serif;position:relative}

  /* soft scanline effect to echo the logo */

  body::before{content:"";position:fixed;inset:0;pointer-events:none;background:repeating-linear-gradient( to bottom, var(--scanline), var(--scanline) 1px, transparent 2px, transparent 3px)}



  header{max-width:1000px;margin:32px auto 8px;padding:0 16px;display:flex;align-items:center;justify-content:space-between}

  .brand{display:flex;align-items:center;gap:12px}

  .logo{height:48px;width:auto;filter:drop-shadow(0 0 8px var(--halo-strong));border-radius:6px}

  h1{font-size:22px;margin:0}

  .muted{color:var(--muted)}



  main{max-width:1000px;margin:0 auto;padding:0 16px 48px}

  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:16px 0}

  button{background:var(--button-bg);border:1px solid var(--border);color:var(--fg);padding:10px 14px;border-radius:10px;cursor:pointer}

  button:hover{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent);}

  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:16px}

  .card{position:relative;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:12px;min-height:360px;box-shadow:0 0 0 1px var(--halo-soft)}

  .row{display:flex;gap:8px;align-items:center}

  input[type="text"], select{flex:1;background:var(--input-bg);border:1px solid var(--border);color:var(--fg);padding:10px 12px;border-radius:10px;outline:none}

  input[type="text"]:focus, select:focus{border-color:var(--accent)}

  .word{font-size:24px;font-weight:700;min-height:30px}

  .pill{font-size:12px;background:var(--pill-bg);border:1px solid var(--border);padding:2px 8px;border-radius:999px;color:var(--muted)}

  .controls{display:flex;gap:8px;flex-wrap:wrap}

  .small{padding:6px 9px;font-size:13px}

  .sub{border:1px dashed var(--halo-strong);border-radius:12px;padding:10px}

  .sub h4{margin:0 0 6px 0;font-size:13px;color:var(--biz-text);letter-spacing:.3px}

  .tag{font-size:11px;padding:2px 6px;border-radius:999px;border:1px solid var(--halo-strong);background:var(--tag-bg);color:var(--tag-text)}

  .hint{font-size:12px;color:var(--hint)}

  .close{position:absolute;top:8px;right:8px;line-height:1;border:1px solid var(--border);background:var(--input-bg);border-radius:8px;padding:4px 8px;cursor:pointer;color:var(--fg);z-index:10;pointer-events:auto}

  .close:hover{border-color:var(--accent)}

  .badge{align-self:flex-start;padding:4px 10px;border-radius:999px;font-weight:600;border:1px solid}

  .badge.business{background:var(--biz);border-color:var(--biz-br);color:var(--biz-text)}

  .badge.personal{background:var(--per);border-color:var(--per-br)}

  .chooser{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:12px;padding:16px;border:1px dashed var(--halo-strong);border-radius:12px;min-height:260px}

  .choices{display:flex;gap:12px;flex-wrap:wrap}

  .typeBtn{display:inline-block;min-width:140px;font-size:16px;padding:12px 16px;border-radius:12px}

  .typeBtn.business{background:var(--business-btn-bg);border:1px solid var(--accent);}

  .typeBtn.business:hover{background:var(--business-btn-hover)}

  .typeBtn.personal{background:var(--personal-btn-bg);border:1px solid var(--per-br)}

  .placeholder{flex:1;display:flex;justify-content:center;align-items:center;border:1px dashed var(--placeholder-border);border-radius:12px;min-height:240px}

  .uc{font-size:14px;padding:8px 12px;border-radius:8px;border:1px solid var(--uc-border);background:var(--uc-bg)}

  #testout{white-space:pre-wrap;background:var(--input-bg);border:1px solid var(--border);padding:10px;border-radius:10px;display:none}

  .ok{color:var(--ok)} .fail{color:var(--fail)}



  /* Welcome overlay */

  .welcome{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 50% -10%, var(--halo-spot), transparent 60%), var(--bg)}

  .welcome.hidden{display:none}

  .welcome-card{max-width:760px;margin:24px;border:1px solid var(--border);background:var(--card);border-radius:16px;padding:28px;text-align:center;box-shadow:0 0 0 1px var(--halo-mid), 0 12px 40px var(--shadow)}

  .welcome .logo-big{height:96px;width:auto;filter:drop-shadow(0 0 10px var(--halo-glow));border-radius:10px}

  .welcome h2{margin:12px 0 6px}

  .welcome p{margin:0 0 16px;color:var(--muted)}

  .welcome-actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

  .welcome button.primary{background:var(--accent);color:var(--primary-on-accent);border-color:var(--accent-2)}

  .welcome .opt{display:flex;gap:8px;justify-content:center;align-items:center;color:var(--muted);font-size:13px;margin-top:8px}

  .logo-fallback{display:inline-flex;align-items:center;justify-content:center;height:48px;min-width:48px;padding:6px 10px;background:linear-gradient(135deg, var(--logo-band), var(--logo-band-soft));border:1px solid var(--accent);border-radius:6px;color:var(--fg);font-weight:700;letter-spacing:.5px}

  .logo-fallback.big{height:96px;font-size:20px;border-radius:10px}

</style>

</head>

<body>

  <!-- Welcome Overlay -->

  <div id="welcome" class="welcome" role="dialog" aria-modal="true" aria-labelledby="wl-title">

    <div class="welcome-card">

      <img class="logo-big" src="logo.png" alt="Logo" />

      <h2 id="wl-title">Word Generator</h2>

      <p>Pick Business or Personal. Generate clean payment descriptions fast.</p>

      <div class="welcome-actions">

        <button id="wl-start" class="primary" type="button">Get started</button>

      </div>

      <div class="opt"><label><input id="wl-skip" type="checkbox" /> Skip this screen next time</label></div>

    </div>

  </div>



  <header>

    <div class="brand">

      <img class="logo" src="logo.png" alt="Words Generator logo" />

      <h1>Business / Personal Transfer Word Generators</h1>

    </div>

    <div class="muted">Pick Business or Personal per box. Business shows Incoming and Outgoing. Personal is under construction.</div>

  </header>

  <main>

    <div class="toolbar">

      <button id="addGen">Add generator</button>

      <button id="resetAll" class="small">Reset all</button>

      <button id="runTests" class="small">Run tests</button>

      <span class="pill" id="stats"></span>

    </div>

    <section id="grid" class="grid"></section>

    <pre id="testout" class="muted"></pre>

  </main>



<script type="module">

  // ────────────────────────────────────────────────────────────

  // Generic outgoing words (apply to all business types)

  const GENERIC_OUT = [

    'Payment','Transfer','Payout','Settlement','Remittance','Subscription','Fees','Service','Supplies','Utilities','Parking','Insurance','Freight','Commission','Royalty','Rent','Lease','Adjustment','Reversal','Surcharge'

  ];



  // Business-specific outgoing words

  const OUT_WORDS_BY_BUSINESS = {

    // Keep for tests

    'Construction': ['Concrete services','Rebar','Aggregate','Formwork','Plant hire','Excavation','Scaffolding','Skip bin','Site prep','Reinforcement','Core drill','Saw cut','Set-out','Temporary fencing'],



    // Sole trader oriented

    'Handyman': ['Call-out','Minor repairs','Hardware','Consumables','Sealant','Silicone','Caulking','Hang doors','Patch & paint','Flatpack assembly','TV mount','Small materials'],

    'Electrician': ['Call-out','Switchboard','Circuit breaker','RCD','GPO outlet','Lighting','Downlights','Earthing','Conduit','Isolator','Test & tag','Compliance certificate','Smoke alarm','Data point'],

    'Plumber': ['Call-out','Blocked drain','Jetting','CCTV drain','Water heater','Pipework','Fittings','Trap replacement','Leak detection','Toilet cistern','TMV test','Backflow test','Water meter'],

    'Carpenter': ['Framing','Fix-out','Skirting','Architraves','Door jamb','Stud wall','Joists','Cladding','Decking','Timber supply','Fasteners','Hardware install'],

    'Painter & Decorator': ['Preparation','Undercoat','Cutting-in','Rollers','Spray finish','Drop sheets','Masking','Colour match','Top coat','Scaffold hire','Touch-up'],

    'Tiler': ['Tiles','Tile adhesive','Screed','Levelling compound','Grout','Grout sealer','Spacers','Waterproofing','Trim','Silicone'],

    'Bricklayer': ['Bricks','Blocks','Mortar','Lintel','Cavity ties','Piers','Sand','Reinforcement','Pointing'],

    'Plasterer': ['Plasterboard','Cornice','Setting compound','Top coat','Beads','Stopping','Sanding','Skim coat','Ceiling repair'],

    'Roofer & Gutterer': ['Roof sheets','Ridge capping','Barge capping','Valley iron','Sarking','Battens','Downpipes','Gutters','Flashing','Leak repair','Gutter guard'],

    'Gutter Cleaning': ['Roof access','Debris removal','Downpipe flush','Leaf guard','Safety gear'],

    'Fencing Contractor': ['Posts','Post-mix','Panels','Palings','Colorbond','Rails','Gates','Hardware','Strainers','Concrete footings'],

    'Flooring Installer': ['Floor prep','Underlay','Adhesive','Floating floor','Hybrid boards','Vinyl planks','Sanding','Polish','Trim & edging'],

    'Glazier': ['Glass','Toughened','Laminated','Double glazed','Reglaze','Sealant','Putty','Beading','Site measure'],

    'Locksmith': ['Call-out','Rekey','Deadbolt','Mortice lock','Cylinder','Transponder key','Key cut','Emergency open'],

    'Pest Control': ['Inspection','Treatment','Bait stations','Termite barrier','Rodent control','Cockroach gel','Follow-up'],

    'Landscaper & Gardener': ['Lawn mowing','Hedging','Edging','Mulch','Topsoil','Planting','Irrigation','Green waste','Pruning','Weed control'],

    'Arborist / Tree Services': ['Tree removal','Pruning','Crown lift','Stump grind','Chipper hire','Arborist report','Traffic control','EWP hire'],

    'Window Cleaning': ['Squeegee','Pure water system','Extension pole','Frame wipe','Internal windows','External windows'],

    'Carpet Cleaning': ['Pre-spray','Hot-water extraction','Bonnet clean','Stain treatment','Urine treatment','Deodoriser','Sanitiser'],

    'Pressure Washing': ['Surface cleaner','Detergent','Degreaser','Driveway clean','Facade wash','PSI test','Rinse down'],

    'Pool Maintenance': ['Chemical balance','Chlorinator','pH adjust','Alkalinity','Shock dose','Filter media','Pump repair','Vacuum'],

    'Waste / Rubbish Removal': ['Tip fees','Disposal','Sorting','Trailer hire','Labour','Load & go','Green waste'],

    'Removalist': ['Truck hire','Two-man crew','Packing','Wrapping','Stairs surcharge','Transit insurance','Trolley'],

    'Courier / Delivery': ['Consignment','Manifest','Fuel levy','Tolls','Run','Signature on delivery','Re-delivery'],

    'Mobile Mechanic': ['Diagnostics','OBD scan','Service kit','Oil & filter','Brake pads','Timing belt','Spark plugs','Road test'],

    'Auto Detailer / Car Wash': ['Detailing','Paint correction','Clay bar','Polish','Wax','Ceramic coat','Interior shampoo','Engine bay'],

    'HVAC Technician': ['Split system','Ducting','Coil clean','Re-gas','Thermostat','Commissioning','Manometer test','Filter change'],

    'Appliance Repair': ['Call-out','Diagnosis','PCB board','Heater element','Pump','Seal','Parts','Labour'],

    'IT Support / Tech': ['Remote support','On-site','RMM','Antivirus','Patch management','Backups','Licences','Email setup'],

    'Phone & Computer Repair': ['Screen replacement','Battery','Digitiser','Housing','Board repair','Data transfer','Case'],

    'Web Designer / Developer': ['Discovery','Wireframes','Design','Build','CMS','Content load','SEO basics','Analytics','Hosting','Domain','Maintenance'],

    'Graphic Designer': ['Brief','Concepts','Revisions','Artwork','Vector files','Raster files','Export pack','Licence'],

    'Photographer / Videographer / Drone': ['Half-day','Full-day','Shoot','RAW files','Editing','Color grade','LUT','Travel km','Drone ops','Music licence'],

    'DJ / Musician': ['Performance','Set list','Soundcheck','PA hire','Lighting','Setup','Travel','Overtime'],

    'Copywriter / Social Media': ['Brief','Copy','Tone of voice','Content calendar','Scheduling','Hashtags','Reporting','Revisions'],

    'Bookkeeper / BAS Agent': ['Bookkeeping','Bank feeds','Reconciliation','Payroll','Super','BAS lodgement','IAS','Xero/MYOB'],

    'Personal Trainer': ['PT session','Block pack','Program','Body comp','Nutrition plan','Travel'],

    'Massage Therapist': ['Remedial','Deep tissue','Relaxation','Oil','HICAPS','Receipt'],

    'Hairdresser / Barber': ['Cut','Restyle','Blow-dry','Toner','Colour','Foils','Balayage','Consumables'],

    'Beauty Therapist / Nails': ['Facial','Waxing','Tint','Lashes','Nails','Gel','SNS','Refill','Supplies'],

    'Dog Walker / Pet Sitter / Groomer': ['Walk','Enrichment','Visit','Groom','Bath','Nail trim','Travel'],

    'Childcare / Nanny': ['Care hours','School run','Activities','Meals','Supplies'],

    'Aged Care Support': ['Support visit','Domestic assist','Shopping assist','Transport','Respite'],

    'Mobile Barista / Food Truck / Catering': ['Coffee beans','Milk','Cups & lids','Gas','Site fee','Service','Generator fuel','Food cost'],

    'Security Installer': ['Alarm panel','CCTV','NVR/DVR','PIR sensor','Reed switch','PoE cabling','Monitoring setup'],

    'Solar Installer': ['Panels','Rails','Inverter','Micro-inverter','String','DC isolator','Commissioning','STC paperwork'],



    // Fallback bucket for unknowns

    'General': []

  };



  // Incoming uses auto-numbered invoice formats

  const INVOICE_FORMATS = [

    { id:'INV_NO_4',       width:4, pattern:'Invoice No {num}' },

    { id:'INV_HASH_4',     width:4, pattern:'Invoice #{num}' },

    { id:'INV_SIMPLE_4',   width:4, pattern:'Invoice {num}' },

    { id:'INV_NUMBER_7',   width:7, pattern:'Invoice Number {num}' },

    { id:'INV_CODE',       width:0, pattern:'INV {num}' },

    { id:'INV_DASH_5',     width:5, pattern:'INV-{num}' },

    { id:'TAX_INV_6',      width:6, pattern:'Tax Invoice {num}' },

    { id:'INV_NO_COLON_5', width:5, pattern:'Invoice No: {num}' }

  ];



  // Business types for dropdown

  const BUSINESS_TYPES = Object.keys(OUT_WORDS_BY_BUSINESS).sort((a,b)=> a.localeCompare(b));



  // ────────────────────────────────────────────────────────────

  // Storage

  const KEY = 'btw_generators_v4';

  const read  = () => JSON.parse(localStorage.getItem(KEY) || '[]');

  const write = (arr) => { try { localStorage.setItem(KEY, JSON.stringify(arr)); } catch(e) { console.warn('localStorage write failed', e); } };

  const WKEY = 'btw_welcome_ok_v1';



  // State

  let gens = read();

  const grid = document.getElementById('grid');

  const stats = document.getElementById('stats');



  // Welcome logic

  const welcome = document.getElementById('welcome');

  const startBtn = document.getElementById('wl-start');

  const skip = document.getElementById('wl-skip');

  if(!localStorage.getItem(WKEY)){

    welcome.classList.remove('hidden');

  } else {

    welcome.classList.add('hidden');

  }

  startBtn.onclick = ()=>{

    if(skip.checked) localStorage.setItem(WKEY,'1');

    welcome.classList.add('hidden');

    document.getElementById('addGen')?.focus();

  };



  // Helpers

  const safeUUID = () => (window.crypto && crypto.randomUUID ? crypto.randomUUID() : ('g-'+Date.now().toString(36)+Math.random().toString(36).slice(2,8)));

  const uniq = (arr) => [...new Set(arr)];

  const pick = (list) => list[Math.floor(Math.random()*list.length)];

  const getOutWordList = (bizType) => uniq([ ...GENERIC_OUT, ...((OUT_WORDS_BY_BUSINESS[bizType])||[]) ]);



  function newGen(){

    return { id: safeUUID(), mode: null, name: '', bizType: 'General', lastOut: '', lastIn: '', inv: null };

  }



  function render(){

    grid.innerHTML='';

    gens.forEach(g => grid.appendChild(card(g)));

    stats.textContent = `${gens.length} boxes • generic words ${GENERIC_OUT.length}`;

  }



  function card(g){

    const el = document.createElement('div');

    el.className='card';

    el.dataset.id = g.id;



    // close (X)

    const close = document.createElement('button');

    close.className='close'; close.setAttribute('aria-label','Close'); close.textContent='×';

    // no direct handler; delegate below to avoid double‑fire



    // badge

    const badge = document.createElement('div');

    badge.className='badge ' + (g.mode==='business' ? 'business' : g.mode==='personal' ? 'personal' : '');

    badge.textContent = g.mode ? (g.mode==='business' ? 'BUSINESS' : 'PERSONAL') : 'SELECT TYPE';



    // if no mode yet, show chooser

    if(!g.mode || (g.mode!=='business' && g.mode!=='personal')){

      const chooser = document.createElement('div');

      chooser.className='chooser';

      const info = document.createElement('div'); info.className='muted'; info.textContent = 'Choose a box type';

      const row = document.createElement('div'); row.className='choices';

      const bBtn = document.createElement('button'); bBtn.className='typeBtn business'; bBtn.textContent='Business'; bBtn.type='button';

      const pBtn = document.createElement('button'); pBtn.className='typeBtn personal'; pBtn.textContent='Personal'; pBtn.type='button';

      bBtn.onclick = (ev)=>{

        ev.preventDefault();

        g.mode='business';

        if(!g.inv){ const fmt=pick(INVOICE_FORMATS); const start=startNumber(fmt); g.inv={fmtId:fmt.id,next:start}; }

        write(gens);

        // swap only this card to avoid full re-render flash

        const newEl = buildBusinessCard(g);

        grid.replaceChild(newEl, el);

      };

      pBtn.onclick = (ev)=>{ ev.preventDefault(); g.mode='personal'; write(gens); const newEl = buildPersonalCard(g); grid.replaceChild(newEl, el); };

      row.append(bBtn,pBtn);

      chooser.append(info,row);

      el.append(close, badge, chooser);

      return el;

    }



    // already has mode

    if(g.mode==='personal') return buildPersonalCard(g, el, close, badge);

    return buildBusinessCard(g, el, close, badge);

  }



  function buildPersonalCard(g, el, close, badge){

    el = el || document.createElement('div');

    el.className='card';

    el.dataset.id = g.id;

    close = close || (()=>{ const b=document.createElement('button'); b.className='close'; b.textContent='×'; return b; })();

    badge = badge || (()=>{ const d=document.createElement('div'); d.className='badge personal'; d.textContent='PERSONAL'; return d; })();



    const nameRow = document.createElement('div'); nameRow.className='row';

    const name = document.createElement('input'); name.type='text'; name.placeholder='Generator name'; name.value=g.name||'';

    name.oninput = (e)=>{ g.name = e.target.value; write(gens); };



    const ph = document.createElement('div'); ph.className='placeholder';

    const uc = document.createElement('div'); uc.className='uc'; uc.textContent='Personal mode — under construction';

    ph.append(uc);



    nameRow.append(name);

    el.replaceChildren(close, badge, nameRow, ph);

    return el;

  }



  function buildBusinessCard(g, el, close, badge){

    el = el || document.createElement('div');

    el.className='card';

    el.dataset.id = g.id;

    close = close || (()=>{ const b=document.createElement('button'); b.className='close'; b.textContent='×'; return b; })();

    badge = badge || (()=>{ const d=document.createElement('div'); d.className='badge business'; d.textContent='BUSINESS'; return d; })();



    // seed invoice if missing (no write here to avoid re-render loops)

    if(!g.inv){ const fmt=pick(INVOICE_FORMATS); const start=startNumber(fmt); g.inv={fmtId:fmt.id,next:start}; }



    const nameRow = document.createElement('div'); nameRow.className='row';

    const name = document.createElement('input'); name.type='text'; name.placeholder='Generator name'; name.value=g.name||'';

    name.oninput = (e)=>{ g.name = e.target.value; write(gens); };



    // business type row (dropdown)

    const bizRow = document.createElement('div'); bizRow.className='row';

    const select = document.createElement('select');

    const types = BUSINESS_TYPES;

    if(!types.includes(g.bizType)) g.bizType = 'General';

    types.forEach(t => {

      const o = document.createElement('option');

      o.value = t;

      o.textContent = t;

      select.appendChild(o);

    });

    select.value = g.bizType || 'General';

    const bizHint = document.createElement('span'); bizHint.className='hint'; bizHint.textContent='Business type';



    // OUTGOING sub-box (depends on business type)

    const outBox = document.createElement('div'); outBox.className='sub';

    const outHeader = document.createElement('div'); outHeader.className='row';

    const outTitle = document.createElement('h4'); outTitle.textContent='Outgoing';

    const outTag = document.createElement('span'); outTag.className='tag'; outTag.textContent=`${getOutWordList(g.bizType).length} words`;

    outHeader.append(outTitle,outTag);

    const outWord = document.createElement('div'); outWord.className='word'; outWord.textContent=g.lastOut||'—';

    const outCtrls = document.createElement('div'); outCtrls.className='controls';

    const outGen = button('Generate', ()=>{ const list=getOutWordList(g.bizType); setOut(g, outWord, pick(list)); });

    const outCopy = smallButton('Copy', async()=> copyText(g.lastOut, outCopy));

    outCtrls.append(outGen,outCopy);

    outBox.append(outHeader,outWord,outCtrls);



    // INCOMING sub-box

    const inBox = document.createElement('div'); inBox.className='sub';

    const inHeader = document.createElement('div'); inHeader.className='row';

    const inTitle = document.createElement('h4'); inTitle.textContent='Incoming (Invoice #)';

    const inFmt = getFmtById(g.inv.fmtId);

    const inTag = document.createElement('span'); inTag.className='tag'; inTag.textContent=inFmt.pattern.replace('{num}','…');

    inHeader.append(inTitle,inTag);

    const inWord = document.createElement('div'); inWord.className='word'; inWord.textContent=g.lastIn||'—';

    const inCtrls = document.createElement('div'); inCtrls.className='controls';

    const inGen = button('Generate', ()=>{ generateInvoice(g, inWord); });

    const inCopy = smallButton('Copy', async()=> copyText(g.lastIn, inCopy));

    inCtrls.append(inGen,inCopy);

    inBox.append(inHeader,inWord,inCtrls);



    // respond to bizType change

    select.onchange = (e)=>{ g.bizType = e.target.value; write(gens); outTag.textContent = `${getOutWordList(g.bizType).length} words`; };



    bizRow.append(select, bizHint);

    nameRow.append(name);

    el.replaceChildren(close, badge, nameRow, bizRow, outBox, inBox);

    return el;

  }



  function button(label, onClick){ const b=document.createElement('button'); b.textContent=label; b.onclick=onClick; b.type='button'; return b; }

  function smallButton(label, onClick){ const b=document.createElement('button'); b.className='small'; b.textContent=label; b.onclick=onClick; b.type='button'; return b; }

  async function copyText(text, btnEl){ if(!text) return; try{ await navigator.clipboard.writeText(text); const old=btnEl.textContent; btnEl.textContent='Copied'; setTimeout(()=>btnEl.textContent=old,900); }catch{} }



  // invoice helpers

  function getFmtById(id){ return INVOICE_FORMATS.find(f=>f.id===id) || INVOICE_FORMATS[0]; }

  function startNumber(fmt){

    const min = 50; // never below 50

    const max = fmt.width>0 ? Math.min(10**fmt.width - 1, 9999999) : 9999999;

    const span = Math.max(0, max - min);

    return min + Math.floor(Math.random()*(span+1));

  }

  function formatInvoice(fmt, n){

    const num = fmt.width>0 ? String(n).padStart(fmt.width,'0') : String(n);

    return fmt.pattern.replace('{num}', num);

  }

  function generateInvoice(g, el){

    if(!g.inv){ const fmt=pick(INVOICE_FORMATS); const start=startNumber(fmt); g.inv={fmtId:fmt.id,next:start}; }

    const fmt = getFmtById(g.inv.fmtId);

    const text = formatInvoice(fmt, g.inv.next);

    g.lastIn = text;

    g.inv.next = g.inv.next + 1;

    el.textContent = text;

    write(gens);

  }

  function setOut(g, el, val){ g.lastOut = val; el.textContent = val; write(gens); }



  // CRUD

  function addGen(){ gens.push(newGen()); write(gens); render(); }

  function removeGen(id){ gens = gens.filter(x=>x.id!==id); write(gens); render(); }



  // Toolbar

  document.getElementById('addGen').onclick = (ev)=>{ ev.preventDefault(); addGen(); };

  document.getElementById('resetAll').onclick = (ev)=>{ ev.preventDefault(); if(confirm('Reset all boxes?')){ gens=[newGen()]; write(gens); render(); } };



  // Two-tap close without blocking confirm dialogs

  function armOrRemove(btn, id){

    const cardEl = btn.closest('.card');

    if(!cardEl) return;

    if(btn.dataset.armed === '1'){

      removeGen(id);

      return;

    }

    btn.dataset.armed = '1';

    const original = btn.textContent;

    btn.textContent = 'Confirm ×';

    setTimeout(()=>{

      if(!btn.isConnected) return;

      btn.dataset.armed = '0';

      btn.textContent = original;

    }, 1600);

  }



  // Delegated close handler (single source of truth)

  grid.addEventListener('click', (ev)=>{

    const btn = ev.target.closest('.close');

    if(!btn) return;

    ev.preventDefault();

    const cardEl = btn.closest('.card');

    const id = cardEl && cardEl.dataset.id;

    if(id) armOrRemove(btn, id);

  });



  // ────────────────────────────────────────────────────────────

  // Tests

  document.getElementById('runTests').onclick = runTests;

  const testOut = document.getElementById('testout');

  function assert(cond, msg){ if(!cond) throw new Error(msg); }



  function runTests(){

    const lines = [];

    const pass = (m)=>lines.push(`✔ ${m}`);

    const fail = (m,e)=>lines.push(`✘ ${m}: ${e.message}`);

    const tryTest = (name, fn)=>{ try{ fn(); pass(name); } catch(e){ fail(name,e); } };



    tryTest('new box starts in select mode', ()=>{ const g = newGen(); assert(g.mode===null, 'mode should start null'); });

    tryTest('invalid mode falls back to chooser', ()=>{ const g=newGen(); g.mode='weird'; const el=card(g); const hasChooser=!!el.querySelector('.choices'); assert(hasChooser,'chooser not shown for invalid mode'); });

    tryTest('choosing Business sets mode and seeds inv', ()=>{ const g = newGen(); g.mode='business'; if(!g.inv){ const fmt=pick(INVOICE_FORMATS); const start=startNumber(fmt); g.inv={fmtId:fmt.id,next:start}; } assert(g.mode==='business','mode not business'); assert(g.inv && g.inv.fmtId,'inv not seeded'); assert(g.inv.next>=50,'start < 50'); });

    tryTest('choosing Personal sets mode and placeholder', ()=>{ const g = newGen(); g.mode='personal'; write([g]); const el = card(g); assert(el.querySelector('.placeholder'),'no placeholder for personal'); assert(el.querySelector('.badge').textContent==='PERSONAL','badge not personal'); });

    tryTest('startNumber() never below 50', ()=>{ for(const fmt of INVOICE_FORMATS){ for(let i=0;i<20;i++){ const n=startNumber(fmt); assert(n>=50, `got ${n} for ${fmt.id}`); } } });

    tryTest('startNumber() respects width', ()=>{ for(const fmt of INVOICE_FORMATS){ if(fmt.width>0){ for(let i=0;i<10;i++){ const n=startNumber(fmt); const max=10**fmt.width-1; assert(n<=max, `n ${n} > ${max}`); } } } });

    tryTest('format padding/no padding', ()=>{ const f={id:'W4',width:4,pattern:'Invoice {num}'}; assert(formatInvoice(f,52)==='Invoice 0052','pad fail'); const f0={id:'W0',width:0,pattern:'INV {num}'}; assert(formatInvoice(f0,52)==='INV 52','nopad fail'); });

    tryTest('generateInvoice holds format and increments', ()=>{ const g=newGen(); g.mode='business'; const fmt=pick(INVOICE_FORMATS); const start=startNumber(fmt); g.inv={fmtId:fmt.id,next:start}; const el=document.createElement('div'); generateInvoice(g,el); const fmtId=g.inv.fmtId; const n1=g.inv.next; const first=g.lastIn; generateInvoice(g,el); assert(g.inv.fmtId===fmtId,'fmt changed'); assert(g.inv.next===n1+1,'no +1'); assert(g.lastIn!==first,'text same'); });

    tryTest('business tag count updates on bizType change', ()=>{ const g=newGen(); g.mode='business'; const el=card(g); const select=el.querySelector('select'); const tag=el.querySelectorAll('.tag')[0]; const before=tag.textContent; select.value='Construction'; select.dispatchEvent(new Event('change')); const after=tag.textContent; assert(before!==after,'tag unchanged'); });

    tryTest('removeGen removes exactly one item', ()=>{ const prev = gens.length; const g = newGen(); gens.push(g); write(gens); removeGen(g.id); if(gens.length !== prev){ throw new Error(`expected length ${prev} got ${gens.length}`); } });

    tryTest('outgoing list mixes generic and business-specific', ()=>{ const list = getOutWordList('Construction'); if(!list.includes('Parking')) throw new Error('Parking missing'); if(!list.includes('Concrete services')) throw new Error('Concrete services missing'); const general = getOutWordList('General'); if(general.includes('Concrete services')) throw new Error('Construction word leaked into General'); });



    testOut.textContent = lines.join('\n');

    testOut.style.display = 'block';

    testOut.className = lines.some(l=>l.startsWith('✘')) ? 'fail' : 'ok';

  }



  // Logo fallbacks for ChatGPT canvas preview

  function installLogoFallback(selector, big=false){

    const img = document.querySelector(selector);

    if(!img) return;

    img.addEventListener('error', ()=>{

      const box = document.createElement('div');

      box.className = 'logo-fallback' + (big ? ' big' : '');

      box.textContent = 'WORD GEN';

      img.replaceWith(box);

    }, { once:true });

  }

  installLogoFallback('.logo');

  installLogoFallback('.logo-big', true);



  // Bootstrap

  if (gens.length===0){ gens=[newGen()]; write(gens); }

  render();

</script>

</body>

</html>

                                                                                                           Q
